\documentclass[sigconf]{acmart}

\usepackage{xspace,listings,url,framed,amssymb,colortbl,
            amsmath,mathpartir,hyperref,doi, rotating,
            stmaryrd, graphicx, tikz, colortbl, xparse, etoolbox, pgffor,booktabs} % double brackets llbracket
\input{macros}

% Copyright
%\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
\setcopyright{rightsretained}
%\setcopyright{usgov}
%\setcopyright{usgovmixed}
%\setcopyright{cagov}
%\setcopyright{cagovmixed}


% DOI
\acmDOI{10.475/123_4}

% ISBN
\acmISBN{123-4567-24-567/08/06}

%Conference
\acmConference[WOODSTOCK'97]{ACM Woodstock conference}{July 1997}{El
  Paso, Texas USA}
\acmYear{1997}
\copyrightyear{2016}
\acmArticle{4}
\acmPrice{15.00}


\begin{document}
\title{Monotonic Gradual Typing in a Common Calculus}
\subtitle{}

\author{Ben Trovato}
\authornote{Dr.~Trovato insisted his name be first.}
\orcid{1234-5678-9012}
\affiliation{%
  \institution{Institute for Clarity in Documentation}
  \streetaddress{P.O. Box 1212}
  \city{Dublin}
  \state{Ohio}
  \postcode{43017-6221}
}
\email{trovato@corporation.com}

\author{John Smith}
\affiliation{\institution{The Th{\o}rv{\"a}ld Group}}
\email{jsmith@affiliation.org}

% The default list of authors is too long for headers.
\renewcommand{\shortauthors}{B. Trovato et al.}


\begin{abstract}
This paper provides a sample of a \LaTeX\ document which conforms,
somewhat loosely, to the formatting guidelines for
ACM SIG Proceedings.\footnote{This is an abstract footnote}
\end{abstract}

%
% The code below should be generated by the tool at
% http://dl.acm.org/ccs.cfm
% Please copy and paste the code instead of the example below.
%
\begin{CCSXML}
<ccs2012>
 <concept>
  <concept_id>10010520.10010553.10010562</concept_id>
  <concept_desc>Computer systems organization~Embedded systems</concept_desc>
  <concept_significance>500</concept_significance>
 </concept>
 <concept>
  <concept_id>10010520.10010575.10010755</concept_id>
  <concept_desc>Computer systems organization~Redundancy</concept_desc>
  <concept_significance>300</concept_significance>
 </concept>
 <concept>
  <concept_id>10010520.10010553.10010554</concept_id>
  <concept_desc>Computer systems organization~Robotics</concept_desc>
  <concept_significance>100</concept_significance>
 </concept>
 <concept>
  <concept_id>10003033.10003083.10003095</concept_id>
  <concept_desc>Networks~Network reliability</concept_desc>
  <concept_significance>100</concept_significance>
 </concept>
</ccs2012>
\end{CCSXML}

\ccsdesc[500]{Computer systems organization~Embedded systems}
\ccsdesc[300]{Computer systems organization~Redundancy}
\ccsdesc{Computer systems organization~Robotics}
\ccsdesc[100]{Networks~Network reliability}


\keywords{ACM proceedings, \LaTeX, text tagging}


\maketitle


\section{Complete translation for Monotonic}

\subsection{Monotonic cast static and dynamic rules}

\begin{minipage}{0.35\textwidth}
\begin{mathpar}
\IRule{W10}{
  \EnvType \Env\s\K\e\tp
}{
  \EnvType \Env\s\K{\MonCast\t\e}\t
}
\end{mathpar}
\end{minipage}
\begin{minipage}{0.5\textwidth}
\begin{tabular}{l@{}l@{~}l@{~}l}
\CondRule{E11}{  %Monotonic cast  
  \moncast \a\t\s\K  \Kp\ap\sp    
}{    
  \ReduceA  \K{\MonCast \t\a}\s \Kp\ap\sp   
} \\
\multicolumn{4}{l}{\EE ::= \ldots \B \MonCast\t\EE }
\end{tabular}
\end{minipage}
\subsection{Monotonic translation for bidirectional expressions}

\begin{align*}
\TRG[M]{\x}\Env = \x & \\
\TRG[M]{\Call{\e_1}\m{{\e_2}}}\Env = \DynCall{\ep_1}\m{\ep_2} & \tag{\IF\EM{\TypeCk{\K,\Env}\e\any
\AND \TRG[M]{\e_1}\Env = \ep_1 \wedge \TAG[M]{\e_2}\Env{\any} = \ep_2}}\\
\TRG[M]{\Call{\e_1}\m{{\e_2}}}\Env = \KCall{\ep_1}\m{\ep_2}{\D[1]}{\D[2]} & \tag{\IF\EM{\TypeCk{\K,\Env}\e\C
\AND \Mtype\m{\D[1]}{\D[2]}\In\App\K\C \AND \TRG[M]{\e_1}\Env = \ep_1 \wedge \TAG[M]{\e_2}\Env{\D[1]} = \ep_2}}\\
\TRG[M]{\New\C{{\e_1}...}}\Env = \New\C{\ep_1...} & \tag{\IF\EM{\Ftype{\f[1]}{\t[1]}\In\App\K\C
    \AND \ep[1] = \TAG[M]{\e[1]}\Env{\t[1]} ~..}}\\
\TAG[M]{\e}{\Env}\t = \e' & \tag{\IF\EM{\TypeCk{\K,\Env}\e\tp \AND \K\vdash\tp\Sub\t}}\\
\TAG[M]{\e}{\Env}\t = \MonCast{\t}{\ep} & \tag{\IF\EM{\TypeCk{\K,\Env}\e\tp \AND \K\vdash\tp\not\Sub\t}}
\end{align*}

\section{Generative Monotone Casts}

\begin{mathpar}
\IRule{CM}{
  \s(\a) = \C\{\ap\ldots\} \\
  \tmeet \a\C\t\s\K = \Cp~\Kp\\
  \sp = \s[\a \mapsto \Cp\{\ap\ldots\}]
}{
  \moncast \a\t\s\K \Kp \sp\\
}
\end{mathpar}
{Monotonic cast semantics}


\opdef{
  $\tmeet{\t}{\tp}\P\K = \tpp\,\Kp$
}{
}
\begin{align*}
\P &::= \cdot \B \P ~{{(\C,\D)}\mapsto\Cp}
\end{align*}
\begin{mathpar}
\IRule{TM1}{ }{\tmeet\C\any\P\K = \C\,\K}

\IRule{TM2}{ }{\tmeet\any\C\P\K = \C\,\K}

\IRule{TM3}{ }{\tmeet\t\t\P\K = \t\,\K}

\IRule{TM4}{
  \fresh\Cp\\
  (\C,\D) \not\in\P \\
  \Pp = \P~{{(\C,\D)}\mapsto\Cp} \\
  \mtype\C\K = {\mt..}\\
  \mtype\D\K = {\mtp..}\\
  \mmeet{\mt..}{\mtp..}\Pp\K = \mtpp..\,\Kp\\
  \Kpp = \Kp~\typegen{\mtpp..}\Cp\\
}{
    \tmeet\C\D\P\K = \Cp\,\Kpp
}

\IRule{TM5}{
    \P(\C,\D) = \Cp
}{
    \tmeet\C\D\P\K = \Cp\,\K
}
\end{mathpar}
{The \texttt{tmeet} function}

\subsection{Meet function}\label{monmeet}

The \texttt{mmeet} function is used by the \texttt{tmeet} functions to
perform the meet over the typing of each method within a class definition.
The \texttt{mmeet} function also takes four arguments, the method
signatures of the original class $\mt..$, the method signatures of the cast
class $\mtp..$, the environment $\P$, a class table $\K$, and outputs method
types $\mtpp..$ and a class table $\Kp$. \\

\hrulefill
\begin{mathpar}
\IRule{MM1}{
}{
  \mmeet{\mt ..}{\cdot}\Env\K =\mt.. ~\K
}

\IRule{MM2}{
}{
  \mmeet{\cdot}{\mt ..}\Env\K ={\mt ..} ~\K
}

\IRule{MM6}{
  \Mtype\m{\t_3}{\t_4} \in {\mt_2} \\
  \tmeet{\t_3}{\t_1}\Env\K = \t_5~\Kp \\
  \tmeet{\t_2}{\t_4}\Env\Kp = {\t_6}~{\Kpp} \\
  \mmeet{{\mt_1 ..}}{{\mt_2 ..}}\Env\Kp = {\mt_3 ..}~\Kpp
}{
  \mmeet{\Mtype\m{\t_1}{\t_2}~{\mt_1 ..}}{{\mt_2 ..}}\Env\K =\Mtype\n{\t_5}{\t_6} ~{\mt_3 ..} ~\Kpp
}
\end{mathpar}

\subsection{Monotonic class generation}\label{classgen}

The \xt{monWrap} function generates the wrapper for the monotonic translations,
when a monotonic cast is required.

\footnotesize
\[\begin{array}{l@{~}r@{}r@{~}r@{~}r@{~}rr}
\arrayrulecolor{white}
\classgen{\C, \md.., \mt.., \mtp.., \D, \K}= \\
\SP \class~\D~\{ \\
\SPP \Fdef\f\t & \All {{\f}\!:{\t} \in \text{fields}(\K,\C)}
\\[1mm]\hline
\SPP \Mdef\m\x\any\any {~\MonCast\any{\KCall\this\m{\MonCast{\t[1]}\x}{\t[1]}{\t[2]}}~}
&     \All \m \Mdef\m\x{\any}{\any}\e\in\md.. &\wedge& \Mtype\m{\C_1}{\C_2}\in{\mtp..}
\\[1mm]\hline
\SPP \Mdef\m\x{\C_1}{\C_2} {\MonCast{\C_2}{[{(\MonCast{\any}\x)}/\x]\ep}~}
&     \All \m \Mdef\m\x{\any}{\any}\e\in\md.. &\wedge& \Mtype\m{\C_1}{\C_2}\in\mtp.. 
\\[1mm]\hline
\SP\}
\end{array}
\]
\normalsize





\subsection{Monotonic equivalent type generation}\label{typegen}

The \xt{typegen} function is used by the \xt{tmeet} function to generate the new classes
of the type produced by the meet operation.

\footnotesize
\[\begin{array}{l@{~}r@{}r@{~}r@{~}r@{~}rr}
\arrayrulecolor{white}
\typegen{\mt..}{\D} = \\
\SP \class~\D~\{
\\[1mm]
\SPP \Mdef\m\x\t\tp {{\MonCast\tp{\x}}} 
&
\All m \Mtype\m\t\tp\in\mt..
\\[1mm]
\SP\}
\end{array}
\]
\normalsize

\bibliographystyle{ACM-Reference-Format}
\bibliography{sample-bibliography}

\end{document}
