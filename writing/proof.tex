\documentclass{report}
\usepackage{fullpage,mathpartir,amsmath,amssymb,listings,amsthm,xspace}


\input{common}

\newtheorem{thm}{Theorem}
\begin{document}

\section{Common case analysis}
\begin{thm} 
\label{castv}For any $v$ and $\t$ s.t. $\Gdash \t$, then there is a $v'$ such that $\cast{\t}v,\s \ereduce v',\s'$ or $\cast{\t}v,\s \ereduce \casterror,\s'$\end{thm}
\begin{proof}
Follows by definition of casting over all systems.
\end{proof}

\begin{thm}
\label{canonforms}If $\Sigma;\cdot \vdash v : \t$ and for some $\s$ s.t. $\Sigma \vdash \s$, then one of the following cases applies:
\begin{itemize}
\item If $\t = \int$, then $v = n$ for some $n$
\item If $\t = \C$, then $v = a$ and $\s[a \is \{\ldots | \C \}$
\item If $\t = \any$ then either $v = n$ for some $n$ or $v = a$ and $\s[a \is \{\ldots | \C \}$
\end{itemize}
\end{thm}

\begin{thm} 
\label{cisnd}If $\Gdash e \tlate e' : \t$ or $\CICAST{e}{\t}{e'}$ then $\Gdash e' : \t$\end{thm}
\begin{proof}
Proceed on mutual rule induction over the derivation.
\begin{tabbing}
Case \=CICast:\\
\> Therefore, we know that $e' = \cast{\t}e''$, and by TCast $\Gdash \cast{\t}e'' : \t$\\
Case CICallAny:\\
\> By the IH, $\Gdash e'' : \any$ and $\bar{\Gdash e''' : \t'}$.\\
\> Therefore, by TUApp, $\Gdash e''.\m(\bar{e'''}) : \any$\\
Case CICall:\\
\> By the IH, $\Gdash e' : \C$ and $\bar{\Gdash e''' : \t}$\\
\> By TApp, $\Gdash e''.\m(\bar{e'''}) : \t$.\\
Case CIIf:\\
\> By the IH, $\Gdash e_1'' : \int$, $\Gdash e_2' : \t_2$, and $\Gdash e_3' : \t_2$.\\
\> Therefore, by TIf, $\Gdash \ifthenelse{e_1'}{e_2'}{e_3'} : \t_2$\\
Case CIPlus:\\
\> By the IH, $\Gdash e_1' : \int$ and $\Gdash e_2' : \int$.\\
\> Therefore, by TPlus, $\Gdash e_1' + e_2' : \int$.\\
Case CIVar:\\
\> By TVar, $\Gdash x:\t$\\
Case CINew:\\
\> By the IH, $\Gdash e' : \t$.\\
\> Then, by TNew, $\Gdash \NEW\C{\bar{e'}} : \C$ \\
Analytic cast insertion uses are covered in the proof for each system.\\
\end{tabbing}
\end{proof}


\section{Monotonic}

\begin{proof}

Extension of theorem~\ref{cisnd}.
\begin{tabbing}
Case \=CIIDown:\\
\> By CICast, $\Gdash \cast{\C}e' : \C$\\
Case CIIUp:\\
\> By the IH, $\Gdash e' : \C$\\
\> By TSub, $\Gdash e' : \xt{D}$\\
Case CIICons:\\
\> By CICast, $\Gdash \cast{\t}e' : \t$\\
Case CIID:\\
\> Trivial.\\
\end{tabbing}
\end{proof}

\begin{thm}$\GSdash \CLASS \C{\xt{D}}{\bar{\f:\t},\bar{\MDEF d{\bar{x:\t''}}{\t'}e}}$ then $\bar{\Sigma;\Gamma,\bar{x:\t''} \vdash e : \t'}$\end{thm}
\begin{proof}
Follows by class wellformedness.
\end{proof}

\begin{thm} Progress and preservation: If $\S;\cdot \vdash e : \t$ and $\S \vdash \s$ then one of the following holds
\begin{itemize}
\item $e$ value
\item $e,\s \ereduce \error,\s'$ for some $\s'$
\item $e,\s \ereduce e',\s'$ where $\S';\cdot \vdash e' : \t$ and $\S' \vdash \s'$ for some $e'$, $\s'$ and $\S'$
\end{itemize}
\end{thm}

\begin{proof}
Proceed by induction on the rule used to derive $\S;\cdot \vdash e : \t$.
\begin{tabbing}
Case \=TVar\\
\> We can exclude TVar as $\cdot$ does not contain any $x$.\\
Case TRef\\
\> $a$ is a value, therefore the theorem holds. \\
Case TInt\\
\> $n$ is a value, therefore the theorem holds. \\
Case TSub\\
\> We apply the induction hypothesis on $\GSdash e : \t'$, then the theorem holds trivially.\\
\> Note that induction is well-founded because the type is getting smaller. \\
Case TUApp\\
\> First,\= we apply the IH to the receiver $e_r$ and case analyze on the result.\\
\> \> Case \=$e_r$ is $F[\cast{\t}e'']$ and $\S;\cdot \vdash e'' : \t'$ where $\t' \not\lesssim \t$:\\
\> \> \> By the definition of frames $e_r.\m(\bar{e'})$ is of the form $F[\cast{\t}e'']$, therefore the theorem holds.\\
\> \> Case $e_r$ is $F[v.\m(\bar{e''})]$ and either $v = n$ or $v = a$ with $\s[a\mapsto \{ \ldots | \C \}]$ and $\m \not\in meths(\C)$:\\
\> \> \> By the definition of frames $e_r.\m(\bar{e'})$ is of the form $F[v.\m(\bar{e''})]$, therefore the theorem holds.\\
\> \> Case $e_r,\s \ereduce e_r',\s'$ where $\S';\cdot \vdash e_r' : \t$ and $\S' \vdash \s'$ for some $e_r'$, $\s'$ and $\S'$\\
\> \> \> $e = F[e_r]$ as TUApp applied and by definition of frames, so we apply EFrame to find that\\
\> \> \> $F[e_r],\s \ereduce F[e_r'],\s'$ with the above definitions, choosing the new $e'$ to be $F[e_r']$, and the others as specified.\\
\> \> \> Theorem holds.\\
\> \> Case $e'$ value:\\
\> Case analyze on $\t$.\\
\> \> Case $\t = \int$\\
\> \> \> $e = F[v.\m(\bar{e})]$ by construction and $v = n$, we get stuck and the theorem holds.\\
\> \> Case $\t = \any$\\
\> \> \> \\
\> \> Case $\t = \C$\\
Case TApp\\
Case TIf\\
Case TPlus\\
Case TNew\\
Case TCast\\
\end{tabbing}
\end{proof}
\section{Typed Racket}
\section{Strongscript}
\end{document}